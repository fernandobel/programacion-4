<?php 

require_once 'includes/db.php';

$edit_note = null;

if (isset($_GET['edit_id']) && is_numeric($_GET['edit_id'])) {
    $edit_id = $_GET['edit_id'];
    try {

        $stmt = $conn->prepare("SELECT id, nombreyapellido, usuario, email, nota FROM notas WHERE id = :id");
        $stmt->bindParam(':id', $edit_id, PDO::PARAM_INT);
        $stmt->execute(); // Ejecuta la consulta.
        $edit_note = $stmt->fetch(PDO::FETCH_ASSOC); 
    } catch (PDOException $e) {

        error_log("Error al obtener nota para edición: " . $e->getMessage());
    }
}
?>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Portafolio profesional de Fernando Beltran, desarrollador web y diseñador">
    <title>Fernando Beltran | Portafolio Profesional</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        .comments-section .alert {
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
        }

        .comments-section .alert.success {
            background-color: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }

        .comments-section .alert.error {
            background-color: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }

        .comment-item {
            border: 1px solid var(--color-borde);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .comment-header h4 {
            margin: 0;
            color: var(--color-primario);
            font-size: 1.1rem;
        }

        .comment-date {
            font-size: 0.85rem;
            color: #777;
        }

        .comment-actions {
            margin-top: 15px;
            text-align: right;
        }

        .comment-actions .btn-small {
            padding: 5px 10px;
            font-size: 0.85rem;
            margin-left: 10px;
        }

        .comment-actions .btn-danger {
            background-color: var(--color-destacado);
        }
        .comment-actions .btn-danger:hover {
            background-color: #c0392b;
        }
        .comment-form .btn-secondary {
            background-color: #6c757d; 
            margin-left: 10px;
        }

        .comment-form .btn-secondary:hover {
            background-color: #5a6268;
        }
        .no-comments, .no-projects {
            text-align: center;
            padding: 30px;
            color: #777;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="#" class="logo">Fernando Beltran</a>
            <ul class="nav-links">
                <li><a href="#inicio">Inicio</a></li>
                <li><a href="#sobre-mi">Sobre Mi</a></li>
                <li><a href="#proyectos">Proyectos</a></li>
                <li><a href="#habilidades">Habilidades</a></li>
                <li><a href="#contacto">Contacto</a></li>
            </ul>
            <div class="menu-btn">
                <div class="btn-line"></div>
                <div class="btn-line"></div>
                <div class="btn-line"></div>
            </div>
        </div>
    </nav>
    <header id="inicio" class="hero">
        <div class="container">
            <div class="hero-content">
                <h1>Hola, mi nombre es <span>Fernando Beltran</span></h1>
                <h2>Estudiante de ingeniería de sistemas de 8° trimestre de la Universidad de Margarita UNIMAR</h2>
                <p>Me encargo de programar a nivel medio en diversos lenguajes y plataformas</p>
                <a href="#proyectos" class="btn">Ver mis proyectos</a>
            </div>
            <div class="hero-image">
                <i class="fas fa-user-circle fa-10x"></i>
            </div>
        </div>
    </header>
    <section id="sobre-mi" class="about">
        <div class="container">
            <h2 class="section-title">Sobre <span>Mi</span></h2>
            <div class="about-content">
                <div class="about-text">
                    <h3>Conóceme mejor</h3>
                    <p>Como mencioné anteriormente soy un estudiante de ingeniería de sistemas a tan solo 4 trimestres para terminar mi carrera, me especializo principalmente en lenguajes como C# y Java, pero también en plataformas como HTML, CSS y Flutter.</p>
                    <p>Mi parte favorita de la programación es la lógica proposicional y la solución de errores, estoy mucho más acostumbrado a trabajar en equipo y ofrecer soluciones a problemas específicos.</p>
                    <div class="about-info">
                        <div>
                            <span>Nombre:</span>
                            <p>Fernando Andres Beltran Rojas</p>
                        </div>
                        <div>
                            <span>Email:</span>
                            <p><a href="mailto:fbeltran.6649@unimar.edu.ve">fbeltran.6649@unimar.edu.ve</a></p>
                        </div>
                        <div>
                            <span>Experiencia:</span>
                            <p>Tengo casi 2 años incursionando en la programación</p>
                        </div>
                        <div>
                            <span>País:</span>
                            <p>Venezuela</p>
                        </div>
                    </div>
                </div>
                <div class="about-skills">
                    <h3>Mis habilidades principales</h3>
                    <h2>Mis especialidades y porcentaje de maestria</h2>
                    <div class="skills">
                        <div class="skill">
                            <div class="skill-info">
                                <span>HTML/CSS</span>
                                <span>65%</span>
                            </div>
                            <div class="skill-bar html"></div>
                        </div>
                        <div class="skill">
                            <div class="skill-info">
                                <span>JavaScript</span>
                                <span>50%</span>
                            </div>
                            <div class="skill-bar js"></div>
                        </div>
                        <div class="skill">
                            <div class="skill-info">
                                <span>Flutter</span>
                                <span>75%</span>
                            </div>
                            <div class="skill-bar flutter"></div>
                        </div>
                        <div class="skill">
                            <div class="skill-info">
                                <span>C#</span>
                                <span>60%</span>
                            </div>
                            <div class="skill-bar csharp"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="proyectos" class="projects">
        <div class="container">
            <h2 class="section-title">Mis <span>Proyectos</span></h2>
            <p class="section-subtitle">Algunos de mis trabajos recientes han sido</p>
            
            <div class="projects-grid" id="projects-container">
                <?php

                try {
                    $sql = "SELECT * FROM proyectos ORDER BY fecha DESC";
                    $stmt = $conn->query($sql);
                    
                    if ($stmt->rowCount() > 0) {
                        while($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
                            echo '
                            <div class="project-card">
                                <div class="project-image">
                                    <i class="fas fa-laptop-code fa-5x"></i>
                                </div>
                                <div class="project-info">
                                    <h3>'.htmlspecialchars($row['cielte']).'</h3>
                                    <p>'.htmlspecialchars($row['descripcion']).'</p>
                                    <div class="project-tech">
                                        <span>Fecha: '.htmlspecialchars($row['fecha']).'</span>
                                    </div>
                                    <div class="project-links">
                                        <a href="#" target="_blank" aria-label="Ver demo"><i class="fas fa-external-link-alt"></i></a>
                                        <a href="#" target="_blank" aria-label="Código fuente"><i class="fab fa-github"></i></a>
                                    </div>
                                </div>
                            </div>';
                        }
                    } else {
                        echo '<p class="no-projects">No hay proyectos para mostrar actualmente.</p>';
                    }
                } catch(PDOException $e) {
                    echo '<p class="error">Error al cargar proyectos: '.htmlspecialchars($e->getMessage()).'</p>';
                }
                ?>
            </div>
        </div>
    </section>

    <section id="comentarios" class="comments-section">
        <div class="container">
            <h2 class="section-title">Comentarios y <span>Notas</span></h2>
            <p class="section-subtitle">Déjame tu comentario o nota</p>
            
            <div class="comments-container">
                <?php

                if (isset($_GET['success'])) {
                    $message = "";
                    if ($_GET['success'] == 'note_saved') {
                        $message = "¡Nota enviada correctamente!";
                    } elseif ($_GET['success'] == 'note_deleted') {
                        $message = "¡Nota eliminada correctamente!";
                    } elseif ($_GET['success'] == 'note_updated') {
                        $message = "¡Nota actualizada correctamente!";
                    }
                    echo '<div class="alert success">' . $message . '</div>';
                } elseif (isset($_GET['error'])) {
                    $message = "";
                    if ($_GET['error'] == 'empty_fields') {
                        $message = "Por favor, completa todos los campos requeridos.";
                    } elseif ($_GET['error'] == 'db_insert_failed' || $_GET['error'] == 'db_error') {
                        $message = "Hubo un error al enviar la nota. Por favor intenta nuevamente.";
                    } elseif ($_GET['error'] == 'delete_failed') {
                        $message = "Hubo un error al eliminar la nota. Por favor intenta nuevamente.";
                    } elseif ($_GET['error'] == 'update_failed' || $_GET['error'] == 'db_error_update') {
                        $message = "Hubo un error al actualizar la nota. Por favor intenta nuevamente.";
                    } elseif ($_GET['error'] == 'empty_fields_edit') {
                        $message = "Por favor, completa todos los campos requeridos para la edición.";
                    }
                    echo '<div class="alert error">' . $message . '</div>';
                }
                ?>

                <form class="comment-form" method="POST" action="<?php echo ($edit_note ? 'includes/actualizar_nota.php' : 'includes/guardar_nota.php'); ?>">
                    <?php if ($edit_note): ?>

                        <input type="hidden" name="edit_id" value="<?php echo htmlspecialchars($edit_note['id']); ?>">
                        <h3>Editar Nota</h3>
                    <?php endif; ?>
                    <div class="form-group">
                        <input type="text" name="nombreyapellido" placeholder="Nombre y Apellido" value="<?php echo htmlspecialchars($edit_note['nombreyapellido'] ?? ''); ?>" required>
                    </div>
                    <div class="form-group">
                        <input type="text" name="usuario" placeholder="Nombre de Usuario (opcional)" value="<?php echo htmlspecialchars($edit_note['usuario'] ?? ''); ?>">
                    </div>
                    <div class="form-group">
                        <input type="email" name="email" placeholder="Correo electrónico" value="<?php echo htmlspecialchars($edit_note['email'] ?? ''); ?>" required>
                    </div>
                    <div class="form-group">
                        <textarea name="nota" placeholder="Escribe tu nota aquí..." required><?php echo htmlspecialchars($edit_note['nota'] ?? ''); ?></textarea>
                    </div>
                    <button type="submit" class="btn"><?php echo ($edit_note ? 'Actualizar Nota' : 'Enviar Nota'); ?></button>
                    <?php if ($edit_note): ?>

                        <a href="Untitled-1.php#comentarios" class="btn btn-secondary">Cancelar Edición</a>
                    <?php endif; ?>
                </form>
                
                <div class="comments-list">
                    <h3>Notas recientes</h3>
                    <?php 

                    include 'includes/mostrar_notas.php'; 
                    ?>
                </div>
            </div>
        </div>
    </section>

    <section id="contacto" class="contact">
        <div class="container">
            <h2 class="section-title">Contáct<span>ame</span></h2>
            <p class="section-subtitle">¿Tienes un proyecto en mente? ¡Contáctame y te ayudaré!</p>
            
            <div class="contact-content">
                <div class="contact-info">
                    <div class="contact-item">
                        <i class="fas fa-envelope"></i>
                        <div>
                            <h3>Email</h3>
                            <p><a href="mailto:fbeltran.6649@unimar.edu.ve">fbeltran.6649@unimar.edu.ve</a></p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <i class="fas fa-phone"></i>
                        <div>
                            <h3>Teléfono</h3>
                            <p><a href="tel:+584248121498">+58 424 812 1498</a></p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <div>
                            <h3>Ubicación</h3>
                            <p>Porlamar Margarita, Venezuela</p>
                        </div>
                    </div>
                    
                    <div class="social-links">
                        <a href="#" target="_blank" aria-label="GitHub"><i class="fab fa-github"></i></a>
                        <a href="#" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
                
                <form class="contact-form">
                    <h3>Otra opción de contacto</h3>
                    <div class="form-group">
                        <input type="text" placeholder="Nombre" required>
                    </div>
                    <div class="form-group">
                        <input type="email" placeholder="Email" required>
                    </div>
                    <div class="form-group">
                        <input type="text" placeholder="Asunto">
                    </div>
                    <div class="form-group">
                        <textarea placeholder="Mensaje" required></textarea>
                    </div>
                    <button type="submit" class="btn">Enviar Mensaje</button>
                </form>
            </div>
        </div>
    </section>
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-about">
                    <h3>Fernando Beltran</h3>
                    <p>Estudiante de ingeniería de sistemas, creando soluciones digitales innovadoras y frescas.</p>
                </div>
                <div class="footer-links">
                    <h3>Enlaces Rápidos</h3>
                    <ul>
                        <li><a href="#inicio">Inicio</a></li>
                        <li><a href="#sobre-mi">Sobre Mí</a></li>
                        <li><a href="#proyectos">Proyectos</a></li>
                        <li><a href="#habilidades">Habilidades</a></li>
                        <li><a href="#contacto">Contacto</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; <span id="year"></span> Fernando Beltran. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script src="assets/js/main.js"></script>
</body>
</html>
